<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>新年倒计时 + 烟花秀</title>
  <style>
    :root {
      --primary-color: #ff4d4d;
      /* 红色 */
      --accent-color: #ffd700;
      /* 金色 */
      --bg-color: #0a0a0a;
    }

    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: var(--bg-color);
      /* 背景色稍微调暗，让烟花更突出 */
      background-image: radial-gradient(circle at center, #111 0%, #000 100%);
      color: white;
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
      overflow: hidden;
      position: relative;
    }

    /* 烟花画布，置于内容后方 */
    #fireworksCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      /* 层级最低 */
      pointer-events: none;
      /* 允许点击穿透 */
    }

    .container {
      text-align: center;
      z-index: 10;
      /* 保证内容在烟花上方 */
      position: relative;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 2rem;
      letter-spacing: 5px;
      color: var(--accent-color);
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    }

    .countdown-wrapper {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .time-box {
      background: rgba(255, 255, 255, 0.08);
      padding: 20px;
      border-radius: 15px;
      min-width: 100px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .time-box:hover {
      transform: translateY(-5px);
      border-color: var(--primary-color);
      box-shadow: 0 8px 25px rgba(255, 77, 77, 0.3);
    }

    .number {
      display: block;
      font-size: 3.5rem;
      font-weight: bold;
      color: white;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .label {
      font-size: 0.9rem;
      color: #aaa;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    #message {
      font-size: 5rem;
      font-weight: 800;
      /* 使用渐变文字让它更喜庆 */
      background: linear-gradient(to right, var(--accent-color), var(--primary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: none;
      /* 简单的浮动动画 */
      animation: floatText 3s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(255, 77, 77, 0.5);
    }

    @keyframes floatText {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    /* 移动端适配 */
    @media (max-width: 600px) {
      .countdown-wrapper {
        gap: 10px;
      }

      .time-box {
        min-width: 65px;
        padding: 12px 8px;
      }

      .number {
        font-size: 1.8rem;
      }

      .label {
        font-size: 0.7rem;
      }

      h1 {
        font-size: 1.3rem;
        letter-spacing: 2px;
      }

      #message {
        font-size: 2.5rem;
      }
    }
  </style>
</head>

<body>
  <canvas id="fireworksCanvas"></canvas>

  <div class="container">
    <h1 id="title">距离 <span class="j-year"></span> 年还有</h1>

    <div class="countdown-wrapper" id="timer">
      <div class="time-box">
        <span class="number" id="days">00</span>
        <span class="label">天</span>
      </div>
      <div class="time-box">
        <span class="number" id="hours">00</span>
        <span class="label">时</span>
      </div>
      <div class="time-box">
        <span class="number" id="minutes">00</span>
        <span class="label">分</span>
      </div>
      <div class="time-box">
        <span class="number" id="seconds">00</span>
        <span class="label">秒</span>
      </div>
    </div>

    <div id="message">✨ <span class="j-year"></span> 新年快乐 ✨</div>
  </div>

  <script>
    const year = new Date().getFullYear();
    document.querySelectorAll('.j-year').forEach(el => {
      el.textContent = year + 1;
    });
    // ===========================
    // 1. 倒计时逻辑
    // ===========================
    const targetDateStr = `January 1, ${year + 1} 00:00:00`; // 目标时间
    let fireworksStarted = false;

    function updateCountdown() {
      const targetTime = new Date(targetDateStr).getTime();
      const now = new Date().getTime();
      const difference = targetTime - now;

      // 时间到！
      if (difference <= 0) {
        document.getElementById('timer').style.display = 'none';
        document.getElementById('title').style.display = 'none';
        document.getElementById('message').style.display = 'block';
        clearInterval(timerInterval);

        // 启动烟花 (只启动一次)
        if (!fireworksStarted) {
          startFireworkShow();
          fireworksStarted = true;
        }
        return;
      }

      // 计算时间单位
      const d = Math.floor(difference / (1000 * 60 * 60 * 24));
      const h = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const m = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
      const s = Math.floor((difference % (1000 * 60)) / 1000);

      // 更新 DOM
      document.getElementById('days').innerText = d.toString().padStart(2, '0');
      document.getElementById('hours').innerText = h.toString().padStart(2, '0');
      document.getElementById('minutes').innerText = m.toString().padStart(2, '0');
      document.getElementById('seconds').innerText = s.toString().padStart(2, '0');
    }

    const timerInterval = setInterval(updateCountdown, 1000);
    updateCountdown(); // 初始化执行

    // ===========================
    // 2. 烟花特效逻辑 (Canvas)
    // ===========================
    const canvas = document.getElementById('fireworksCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    // 设置画布大小为全屏
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // 粒子类 Definition
    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        // 随机大小
        this.radius = Math.random() * 2.5 + 1;
        // 随机爆炸速度方向
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 6 + 2;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        // 物理模拟
        this.gravity = 0.06; // 重力下坠
        this.friction = 0.97; // 空气阻力减速
        this.alpha = 1; // 透明度
        // 随机衰减速度，让烟花消失得更自然
        this.decay = Math.random() * 0.015 + 0.01;
      }

      draw() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        // 绘制圆形粒子
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        // 添加一点发光效果
        ctx.shadowBlur = 10;
        ctx.shadowColor = this.color;
        ctx.restore();
      }

      update() {
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.vy += this.gravity;
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= this.decay; // 逐渐消失
      }
    }

    // 在指定位置创建爆炸
    function explode(x, y) {
      // 新年配色方案
      const colors = ['#ff4d4d', '#ffd700', '#ffffff', '#ff8c00', '#00ff7f'];
      // 随机选一个颜色作为主色调
      const mainColor = colors[Math.floor(Math.random() * colors.length)];

      // 每个烟花产生 60-80 个粒子
      const particleCount = Math.floor(Math.random() * 20) + 60;
      for (let i = 0; i < particleCount; i++) {
        //偶尔混入白色粒子增加闪烁感
        const color = Math.random() > 0.8 ? '#ffffff' : mainColor;
        particles.push(new Particle(x, y, color));
      }
    }

    // 动画循环
    function animateFireworks() {
      requestAnimationFrame(animateFireworks);
      // 关键点：使用半透明黑色覆盖，形成拖尾效果
      ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      particles.forEach((particle, index) => {
        if (particle.alpha > 0) {
          particle.update();
          particle.draw();
        } else {
          // 移除消失的粒子
          particles.splice(index, 1);
        }
      });
    }

    // 开始烟花秀的函数
    function startFireworkShow() {
      animateFireworks(); // 启动动画循环

      // 初始来几个大爆炸
      explode(canvas.width / 2, canvas.height / 3);
      setTimeout(() => explode(canvas.width / 3, canvas.height / 4), 300);
      setTimeout(() => explode(canvas.width * 2 / 3, canvas.height / 4), 600);

      // 持续随机发射
      setInterval(() => {
        const x = Math.random() * canvas.width;
        // 爆炸点主要集中在屏幕上方 2/3 区域
        const y = Math.random() * canvas.height * 0.6;
        explode(x, y);
      }, 800); // 每 800ms 发射一次
    }

    // 【调试提示】：
    // 如果想现在立刻看到烟花效果，请取消下面这行代码的注释：
    startFireworkShow(); 
  </script>
</body>

</html>